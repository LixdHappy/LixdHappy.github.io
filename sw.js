(()=>{const e="GB-BlogCache",t=Symbol(),n="https://id.v3/",s=15,r="X-Swpp-Invalid",a="X-Swpp-Time",i=e=>[200,301,302,307,308].includes(e.status),c=e=>{const t=t=>{const n=e.value;if(Array.isArray(n)){for(let e of n)if(t(e))return!0;return!1}return t(n)};switch(e.flag){case"html":return e=>/\/$|\.html$/.test(e);case"suf":return e=>t(t=>e.endsWith(t));case"pre":return e=>t(t=>e.startsWith(t));case"str":return e=>t(t=>e.includes(t));case"reg":return e=>t(t=>new RegExp(t,"i").test(e));default:throw e}},o=t=>caches.match(t,{cacheName:e}),l=async(t,n,s)=>{if(s){const e=new Headers(n.headers);e.set(a,(new Date).toISOString()),n=new Response(n.body,{status:n.status,headers:e})}const r=await caches.open(e);await r.put(t,n)},u=e=>o(e).then(t=>{if(!t)return;const n=new Headers(t.headers);return n.set(r,"1"),l(e,new Response(t.body,{status:t.status,headers:n}))}),h=()=>o(n).then(e=>e?.json?.()),d=e=>(e.tp=Date.now(),l(n,new Response(JSON.stringify(e)))),f=async(e,t,...n)=>{n.length||(n=await clients.matchAll());const s={type:e,data:t};for(let e of n)e.postMessage(s)},p=e=>new Response(JSON.stringify({type:e.name,message:e.message,stack:e.stack,addition:e}),{status:599,headers:{"Content-Type":"application/json"}}),w=(e,t,n,s)=>{const r={referrerPolicy:e.referrerPolicy??"",...s};return r.cache=t?"no-store":"default",n&&(r.mode="cors",r.credentials="same-origin"),fetch(e,r)},m=(e,t)=>{const n=e.url?e:new Request(e),s=(e=>{const t=e.url,{host:n,pathname:s}=new URL(t),r=["cdn.cbd.int","npm.elemecdn.com","cdn.staticfile.org","cdn.smartcis.cn","unpkg.com"],a=t=>new Request(t,e);if("npm.elemecdn.com"===n)return{t:2e3,l:()=>[...r.map(e=>`https://${e}/npm${s}`)].map(a)};if("cdn.cbd.int"===n){const e=r.filter(e=>"cdn.cbd.int"!==e);return{t:2e3,l:()=>[...e.map(e=>`https://${e}${s}`)].map(a)}}})(n);return s?(async(e,t,n)=>{const s=(e,t)=>w(e,!0,!0,{...n,signal:t?.signal});let r,a,c;const o=(e,t)=>i(t)?{i:e,r:t}:Promise.reject(t),{t:l,r:u,l:h}=t,d=new Array(h.length+1),f=()=>Promise.any(h().map((e,t)=>s(e,d[t+1]=new AbortController).then(e=>o(t+1,e)))).then(e=>a(e)).catch(()=>c()),m=s(u||e,d[0]=new AbortController).then(e=>o(0,e)).catch(e=>(clearTimeout(r),f(),Promise.reject(e))),g=new Promise((e,t)=>{a=e,c=t,r=setTimeout(f,l)});try{const{i:e,r:t}=await Promise.any([m,g]);for(let t=0;d[t];t++)t!=e&&d[t].abort();return t}catch(e){const t=e.errors[0];return t.body?t:p(e)}})(n,s,t):w(n,!0,!1,t).catch(p)},g=async(t,r)=>{if(!r&&t&&Date.now()-t.tp<6e5)return;const a=await(await fetch("swpp/update.json",{priority:"high"})).json(),{global:i,info:o}=a,l={global:i,local:o[0].version,escape:s};if(!t||s!==t.escape)return await d(l),t?1:-1;if(t.global===i&&t.local===l.local)return void await d(t);const h=[];for(let s of o){if(s.version===t.local){const t=[],s=await caches.open(e),r=await s.keys();for(let e of r){const s=e.url;s!==n&&h.find(e=>e(s))&&(await u(e),t.push(s))}return await d(l),t}const r=s.change;if(r)for(let e of r)h.push(c(e))}return await caches.delete(e),await d(l),2},y=e=>{let n=e.request;if("GET"!==n.method||!n.url.startsWith("http"))return;const s=null;let c=n.url;for(let e=0;e<c.length;e++){const t=c[e];"?"!==t&&"#"!==t||(c=c.substring(0,e))}const u=new URL((h=c).endsWith("/index.html")?h.substring(0,h.length-10):h.endsWith(".html")?h.substring(0,h.length-5):h);var h;const d=(e=>{let{host:t,pathname:n}=e;if(n.endsWith("/")&&(n+="index.html"),t.endsWith("blog.gbfun.cc")){if(n.endsWith(".json"))return 36e5;if(n.endsWith(".html"))return!1;if(n.endsWith(".webp")||n.endsWith(".jpg")||n.endsWith(".png"))return 432e5}if(/\.(js|css|woff2|woff|ttf|cur)$/.test(e.pathname))return 1728e5})(u);d&&e.respondWith(o(u).then(e=>{if(e&&((e,n)=>{const s=e.headers;if(s.has(r))return!1;if(n===t)return!0;const i=s.get(a);if(!i)return!0;const c=new Date(i).getTime();return Date.now()-c<n})(e,d))return e;const s=m(n).then(t=>i(t)?(l(u,t.clone()),t):e??t);return e?s.catch(()=>e):s}))};self.addEventListener("install",t=>{skipWaiting(),(async()=>{const t=await h();t&&t.escape!==s&&(await caches.delete(e),await f("escape",null))})()}),self.addEventListener("activate",e=>e.waitUntil(clients.claim())),self.addEventListener("fetch",e=>y(e)),self.addEventListener("periodicSync",e=>{"update"===e.tag&&e.waitUntil(g(null,!0))}),self.addEventListener("message",async e=>{if("update"===e.data.type){const e=await h(),t=await g(e);if(!t)return;switch(t){case-1:return f("new",null);case 1:return f("revise",null);case 2:return f("update",null);default:if(Array.isArray(t))return f("update",t)}}})})();